<html th:replace="~{layout/baseAnonimo :: html}">
<main th:fragment="contenido" class="auth-main">
    <div class="text-center mb-4">
        <h1 class="h3 mb-3 fw-normal">Contribuir</h1>
        <p style="font-size: 0.9rem; color: #6c757d; margin-top: -10px; margin-bottom: 20px;">Los campos con <span
                style="color: red;">*</span> son obligatorios</p>
        <p class="text-muted">Añade un nuevo hecho a MetaMapa.</p>
    </div>
    <div class="row">
        <div class="col-md-6">
            <div class="card p-4 shadow-sm mb-4">
                <form th:action="@{/anonimo/hecho}" method="post" th:object="${hecho}">
                    <div class="mb-3">
                        <label for="categoria" class="form-label">Categoria<span style="color: red;">*</span></label>
                        <input id="categoria" type="text" class="form-control" th:field="*{categoria}" required/>
                    </div>
                    <div class="mb-3">
                        <label for="titulo" class="form-label">Titulo<span style="color: red;">*</span></label>
                        <input id="titulo" type="text" class="form-control" th:field="*{titulo}" required/>
                    </div>
                    <div class="mb-3">
                        <label for="descripcion" class="form-label">Descripcion<span
                                style="color: red;">*</span></label>
                        <textarea id="descripcion" class="form-control" rows="3" th:field="*{descripcion}"
                                  required></textarea>
                    </div>
                    <div class="mb-3">
                        <label for="fechaDelHecho" class="form-label">Fecha del Hecho<span style="color: red;">*</span></label>
                        <input id="fechaDelHecho" type="date" class="form-control" th:field="*{fechaDelHecho}"
                               required/>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Latitud<span style="color: red;">*</span></label>
                            <input type="text" class="form-control" th:field="*{ubicacion.latitud}"
                                   required/>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Longitud<span style="color: red;">*</span></label>
                            <input type="text" class="form-control" th:field="*{ubicacion.longitud}"
                                   required/>
                        </div>
                    </div>
                    <div class="d-grid mt-4">
                        <button class="btn btn-primary" type="submit">Crear</button>
                    </div>
                </form>
            </div>
        </div>

        <div class="col-md-6" style="overflow: hidden;">
            <div id="map" style="height: 500px; border-radius: 8px; width: 100%;"></div>
            <p class="text-muted text-center mt-2">Haz clic en el mapa para seleccionar la ubicación.</p>
        </div>
    </div>
</main>
</html>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet"/>
<link rel="stylesheet" th:href="@{/css/auth.css}"/>
<link crossorigin="" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
      integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
      rel="stylesheet"/>
<script crossorigin="" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
        src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<!-- MAPA -->
<link rel="stylesheet"
      crossorigin=""
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
      integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="/>
<script crossorigin="" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
        src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="/js/map.js"></script>
<script>
    $(document).ready(function() {
        map.on('click', function () {
            $("#ubicacion\\.latitud").val(ubicacion.lat);
            $("#ubicacion\\.longitud").val(ubicacion.lng);
        });
    });
</script>
<script th:inline="javascript">
    /*<![CDATA[*/

    let hechos = JSON.parse([[${hechosJSON}]]);

    hechos.forEach(
        function(hecho) {
            var marker = L.marker([Number(hecho.ubicacion.latitud), Number(hecho.ubicacion.longitud)]).addTo(map);
            marker.bindPopup("<b>"+hecho.fechaDelHecho+" - "+hecho.titulo+"</b>");
            map.setView(marker.getLatLng(), 13);
        }
    );
    /*]]>*/
</script>